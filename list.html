<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create New List - TaskMaster Pro</title>
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="TaskMaster Pro - Create custom task lists and categories" />
  <meta name="theme-color" content="#4f46e5" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="TaskMaster Pro" />
  <meta name="msapplication-TileColor" content="#4f46e5" />
  <meta name="msapplication-config" content="browserconfig.xml" />
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json" />
  
  <!-- OneSignal for iOS notifications -->
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
  
  <!-- Favicon and App Icons -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHJ4PSIxMiIgZmlsbD0iIzRmNDZlNSIvPgogIDxwYXRoIGQ9Ik0xOCAyNGw0IDRsOC04IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjMiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4K" />
  <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHJlY3Qgd2lkdGg9IjE5MiIgaGVpZ2h0PSIxOTIiIHJ4PSI0OCIgZmlsbD0iIzRmNDZlNSIvPgogIDxwYXRoIGQ9Ik03MiA5NmwxNiAxNmwzMi0zMiIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPgo=" />
  
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      padding: 20px; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
    }
    
    /* Navigation Bar */
    .navbar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 15px 0;
      margin: -20px -20px 30px -20px;
      text-align: center;
      box-shadow: 0 2px 20px rgba(0,0,0,0.1);
    }
    .navbar a {
      color: #4f46e5;
      text-decoration: none;
      margin: 0 20px;
      padding: 8px 16px;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    .navbar a:hover {
      background: rgba(79, 70, 229, 0.1);
      transform: translateY(-1px);
    }
    .navbar a.active {
      background: #4f46e5;
      color: white;
      font-weight: 600;
    }
    
    /* Main Container */
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
    }
    
    h1 {
      color: #4f46e5;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.5em;
      font-weight: 700;
    }
    
    /* Create List Form */
    .create-list-form {
      background: #f8f9ff;
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 40px;
      border: 2px solid #e0e7ff;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #d1d5db;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #4f46e5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }
    
    .form-textarea {
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }
    
    .create-btn {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 10px;
    }
    
    .create-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3);
    }
    
    .create-btn:active {
      transform: translateY(0);
    }
    
    /* Custom Lists Display */
    .custom-lists {
      margin-top: 40px;
    }
    
    .custom-lists h2 {
      color: #374151;
      margin-bottom: 20px;
      font-size: 1.5em;
      font-weight: 600;
    }
    
    .list-item {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .list-item:hover {
      border-color: #4f46e5;
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    
    .list-item h3 {
      color: #4f46e5;
      margin: 0 0 8px 0;
      font-size: 1.2em;
      font-weight: 600;
    }
    
    .list-item p {
      color: #6b7280;
      margin: 0 0 15px 0;
      line-height: 1.5;
    }
    
    .list-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .btn-small {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-edit {
      background: #10b981;
      color: white;
    }
    
    .btn-edit:hover {
      background: #059669;
      transform: translateY(-1px);
    }
    
    .btn-delete {
      background: #ef4444;
      color: white;
    }
    
    .btn-delete:hover {
      background: #dc2626;
      transform: translateY(-1px);
    }
    
    .btn-view {
      background: #4f46e5;
      color: white;
    }
    
    .btn-view:hover {
      background: #4338ca;
      transform: translateY(-1px);
    }
    
    /* Success/Error Messages */
    .message {
      padding: 15px 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-weight: 500;
    }
    
    .message.success {
      background: #d1fae5;
      color: #065f46;
      border: 2px solid #10b981;
    }
    
    .message.error {
      background: #fee2e2;
      color: #991b1b;
      border: 2px solid #ef4444;
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #6b7280;
    }
    
    .empty-state .icon {
      font-size: 4em;
      margin-bottom: 20px;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        margin: 10px;
        padding: 20px;
        border-radius: 16px;
      }
      
      h1 {
        font-size: 2em;
      }
      
      .navbar a {
        margin: 0 10px;
        padding: 6px 12px;
        font-size: 14px;
      }
      
      .list-actions {
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <a href="index.html">TaskMaster Home</a>
    <a href="taskmaster.html">Your Lists</a>
    <a href="list.html" class="active">Create List</a>
    <a href="options.html">Options</a>
  </nav>

  <div class="container">
    <h1>üìù Create New List</h1>
    
    <!-- User Privacy Information -->
    <div class="privacy-info" style="background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 12px; padding: 15px; margin-bottom: 20px; font-size: 14px;">
      <strong>üîí Privacy Notice:</strong> Your custom lists are stored locally on this device only. Each browser/device gets its own unique user ID. 
      Your lists will not be visible to other users or on other devices. 
      <span id="userIdDisplay" style="color: #0369a1; font-family: monospace;"></span>
    </div>
    
    <!-- Success/Error Messages -->
    <div id="messageContainer"></div>
    
    <!-- Create List Form -->
    <div class="create-list-form">
      <form id="createListForm">
        <div class="form-group">
          <label class="form-label" for="listName">List Name *</label>
          <input 
            type="text" 
            id="listName" 
            class="form-input" 
            placeholder="e.g., Home Projects, Work Tasks, Shopping..." 
            required 
            maxlength="50"
          />
        </div>
        
        <div class="form-group">
          <label class="form-label" for="listDescription">Description (Optional)</label>
          <textarea 
            id="listDescription" 
            class="form-input form-textarea" 
            placeholder="Brief description of what this list is for..."
            maxlength="200"
          ></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="listColor">List Color</label>
          <select id="listColor" class="form-input">
            <option value="#4f46e5">üîµ Blue (Default)</option>
            <option value="#10b981">üü¢ Green</option>
            <option value="#f59e0b">üü° Orange</option>
            <option value="#ef4444">üî¥ Red</option>
            <option value="#8b5cf6">üü£ Purple</option>
            <option value="#06b6d4">üîµ Cyan</option>
            <option value="#84cc16">üü¢ Lime</option>
            <option value="#f97316">üü† Orange Red</option>
            <option value="#ec4899">ü©∑ Pink</option>
            <option value="#64748b">‚ö´ Gray</option>
          </select>
        </div>
        
        <button type="submit" class="create-btn">
          ‚ú® Create List
        </button>
      </form>
    </div>
    
    <!-- Custom Lists Display -->
    <div class="custom-lists">
      <h2>üìã Your Custom Lists</h2>
      <div id="customListsContainer">
        <!-- Custom lists will be populated here -->
      </div>
    </div>
  </div>

  <script>
    // Generate or get unique user ID for this browser/device
    function getUserId() {
      let userId = localStorage.getItem('taskmaster_user_id');
      if (!userId) {
        // Generate unique user ID: timestamp + random string
        userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('taskmaster_user_id', userId);
        console.log('üÜî New user ID generated:', userId);
      }
      return userId;
    }
    
    // Custom lists storage - user-specific
    function getCustomListsKey() {
      return `taskmaster_custom_lists_${getUserId()}`;
    }
    
    function getCustomSectionNamesKey() {
      return `taskmaster_custom_section_names_${getUserId()}`;
    }
    
    // Get custom lists from localStorage (user-specific)
    function getCustomLists() {
      const lists = localStorage.getItem(getCustomListsKey());
      return lists ? JSON.parse(lists) : [];
    }
    
    // Save custom lists to localStorage (user-specific)
    function saveCustomLists(lists) {
      localStorage.setItem(getCustomListsKey(), JSON.stringify(lists));
    }
    
    // Generate unique ID for lists
    function generateListId() {
      return 'custom_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }
    
    // Show message to user
    function showMessage(text, type = 'success') {
      const container = document.getElementById('messageContainer');
      const message = document.createElement('div');
      message.className = `message ${type}`;
      message.textContent = text;
      
      container.innerHTML = '';
      container.appendChild(message);
      
      // Auto-hide message after 5 seconds
      setTimeout(() => {
        message.style.opacity = '0';
        setTimeout(() => {
          if (message.parentNode) {
            message.parentNode.removeChild(message);
          }
        }, 300);
      }, 5000);
    }
    
    // Create new custom list
    function createCustomList(name, description, color) {
      const lists = getCustomLists();
      
      // Check if list name already exists
      if (lists.find(list => list.name.toLowerCase() === name.toLowerCase())) {
        showMessage('A list with this name already exists!', 'error');
        return false;
      }
      
      const newList = {
        id: generateListId(),
        name: name.trim(),
        description: description.trim(),
        color: color,
        createdAt: new Date().toISOString(),
        taskCount: 0
      };
      
      lists.push(newList);
      saveCustomLists(lists);
      
      // Update the sections array in the main app
      updateMainAppSections();
      
      showMessage(`List "${name}" created successfully! üéâ`);
      displayCustomLists();
      return true;
    }
    
    // Delete custom list
    function deleteCustomList(listId) {
      if (!confirm('Are you sure you want to delete this list? This action cannot be undone.')) {
        return;
      }
      
      const lists = getCustomLists();
      const filteredLists = lists.filter(list => list.id !== listId);
      saveCustomLists(filteredLists);
      
      // Update the sections array in the main app
      updateMainAppSections();
      
      showMessage('List deleted successfully!');
      displayCustomLists();
    }
    
    // Edit custom list
    function editCustomList(listId) {
      const lists = getCustomLists();
      const list = lists.find(l => l.id === listId);
      
      if (!list) return;
      
      const newName = prompt('Enter new list name:', list.name);
      if (!newName || newName.trim() === '') return;
      
      // Check if new name conflicts with existing lists
      if (lists.find(l => l.id !== listId && l.name.toLowerCase() === newName.toLowerCase())) {
        alert('A list with this name already exists!');
        return;
      }
      
      const newDescription = prompt('Enter new description (optional):', list.description);
      
      list.name = newName.trim();
      list.description = newDescription ? newDescription.trim() : '';
      
      saveCustomLists(lists);
      updateMainAppSections();
      
      showMessage(`List "${list.name}" updated successfully!`);
      displayCustomLists();
    }
    
    // Update the main app's SECTIONS array (user-specific)
    function updateMainAppSections() {
      const customLists = getCustomLists();
      const customListNames = customLists.map(list => list.name);
      
      // Store custom list names for the main app to use (user-specific)
      localStorage.setItem(getCustomSectionNamesKey(), JSON.stringify(customListNames));
    }
    
    // Display custom lists
    function displayCustomLists() {
      const container = document.getElementById('customListsContainer');
      const lists = getCustomLists();
      
      if (lists.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="icon">üìù</div>
            <h3>No custom lists yet</h3>
            <p>Create your first custom list above to get started!</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = lists.map(list => `
        <div class="list-item" style="border-left: 5px solid ${list.color}">
          <h3>${list.name}</h3>
          <p>${list.description || 'No description provided'}</p>
          <small style="color: #9ca3af;">Created: ${new Date(list.createdAt).toLocaleDateString()}</small>
          
          <div class="list-actions">
            <button class="btn-small btn-view" onclick="viewList('${list.id}')">
              üìã View Tasks
            </button>
            <button class="btn-small btn-edit" onclick="editCustomList('${list.id}')">
              ‚úèÔ∏è Edit
            </button>
            <button class="btn-small btn-delete" onclick="deleteCustomList('${list.id}')">
              üóëÔ∏è Delete
            </button>
          </div>
        </div>
      `).join('');
    }
    
    // View list tasks (redirect to taskmaster.html with focus on this list)
    function viewList(listId) {
      const lists = getCustomLists();
      const list = lists.find(l => l.id === listId);
      
      if (list) {
        // Store the list to focus on
        sessionStorage.setItem('focusList', list.name);
        window.location.href = 'taskmaster.html';
      }
    }
    
    // Form submission handler
    document.getElementById('createListForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const name = document.getElementById('listName').value.trim();
      const description = document.getElementById('listDescription').value.trim();
      const color = document.getElementById('listColor').value;
      
      if (!name) {
        showMessage('Please enter a list name!', 'error');
        return;
      }
      
      if (createCustomList(name, description, color)) {
        // Clear form
        this.reset();
      }
    });
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      // Display user ID in privacy section
      const userIdDisplay = document.getElementById('userIdDisplay');
      if (userIdDisplay) {
        userIdDisplay.textContent = `(Your User ID: ${getUserId()})`;
      }
      
      displayCustomLists();
    });
  </script>
</body>
</html>